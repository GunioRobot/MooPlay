<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>Mooplay demonstration : build your own player on top of an html5 video element</title>
	
	

    	
	<!-- MooTools -->
    <script src="/Assets/mootools-1.2.4-core-nc.js" type="text/javascript"></script>
    <script src="/Assets/mootools-1.2.4.4-more.js" type="text/javascript"></script>
    
    <!-- ProgressBar -->
    <script src="/Assets/ProgressBar.js" type="text/javascript"></script>

    <!-- SubRipReader -->
    <script src="/Source/MooPlay.js" type="text/javascript"></script>
    <script src="/Source/Utils.js" type="text/javascript"></script>
    <script src="/Source/Control/PlayProgress.js" type="text/javascript"></script>
    <script src="/Source/Control/LoadProgress.js" type="text/javascript"></script>
    <script src="/Source/Control/BaseButton.js" type="text/javascript"></script>
    <script src="/Source/Control/PlayPause.js" type="text/javascript"></script>
    <script src="/Source/Control/FastMove.js" type="text/javascript"></script>
    <script src="/Source/Display/Ratio.js" type="text/javascript"></script>
    <script src="/Source/Control/TimeDisplay.js" type="text/javascript"></script>
    <script src="/Source/Subtitle/Item.js" type="text/javascript"></script>
    <script src="/Source/Subtitle/Tree.js" type="text/javascript"></script>
    <script src="/Source/Subtitle/Loader.js" type="text/javascript"></script>
    <script src="/Source/Subtitle/Player.js" type="text/javascript"></script>
    <script src="/Source/Subtitle/Parser/Base.js" type="text/javascript"></script>
    <script src="/Source/Subtitle/Parser/SubRip.js" type="text/javascript"></script>
    <script src="/Source/Subtitle/Parser/SubViewer.js" type="text/javascript"></script>
    
	<link rel="stylesheet" href="/Assets/demo.css" type="text/css" media="screen" title="no title" charset="utf-8">
</head>


<body>

<a href="http://github.com/challet/MooPlay/">
    <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" />
</a>

<div style="width:400px; height:300px;">
    <div style="position:relative;">
        <video id="video" src="http://blip.tv/file/get/Framasoft-WhatsNewInFirefox35717.ogv" autobuffer="false" style="width:400px;height:300px;position:absolute;top:0;z-index:1"></video>
        <div id="subtitle"></div>
        <div style="clear:both;"></div>
    </div>
    <div style="clear:both;"></div>
</div>
<div style="clear:both;"></div>


<div id="slider_progress" style="width:400px;height:5px;background:#a0a0a0;">
    <div id="knob_progress" style="width:5px;height:5px;background:#ffff80;"></div>
</div>
<div id="progress_container" style="width:400px;height:5px;background:#a0a0a0;">
</div>
<br />

<div>
    time : <span id="current_time_container">00:00:00</span> ( - <span id="remaining_time_container">00:00:00</span> )
</div>

<a id="fastrewindbutton" href="#">
    fast rewind
</a>
&nbsp
<a id="playpausebutton" href="#">
    play/pause
</a>
&nbsp 
<a id="fastforwardbutton" href="#">
    fast forward
</a>


<form id="time_shift">
    
    <label for="subtitles">subtitle :</label>
    <select id="subtitles">
        <option value="">none</option>
        <option value="/Assets/Framasoft-WhatsNewInFirefox35717.srt">FR (SubRip format)</option>
        <option value="/Assets/Framasoft-WhatsNewInFirefox35717.sub">FR (SubViewer format)</option>
    </select>
    
    <br />
    
    <label for="time_shift_setter">subs time shift :</label>
    <input type="text" id="time_shift_setter" value="8050" /> 
    
    <input type="submit" value="set" />
    
</form>

<hr />
<p> The video used in this demonstration page is from Framasoft and the original file can be found <a href="http://blip.tv/file/2296139">here</a> </p>
<p> The subtitle file is a french translation made by Joan from Framalang and can be found <a href="http://www.framalang.org/wiki/Whats_new_in_firefox_three_five">here</a> </p>
<p>
    Want to see unit tests running ? you should go <a href="/Specs/?specs=master">here</a>
</p>
<script>

var reader = null;

document.addEvent('domready', function() {
    
    new MooPlay.Control.PlayPause($('playpausebutton'), $('video'));
    new MooPlay.Control.FastMove($('fastforwardbutton'), $('video'), {speed_factor: 6});
    new MooPlay.Control.FastMove($('fastrewindbutton'), $('video'), {speed_factor: -4});
    
    new MooPlay.Control.TimeDisplay($('video'), $('current_time_container'), {pattern: '{h}:{m}:{s}', current: true});
    new MooPlay.Control.TimeDisplay($('video'), $('remaining_time_container'), {pattern: '{h}:{m}:{s}', current: false});
    
    var slider_progress = new Slider($('slider_progress'), $('knob_progress'), {steps: 400});
    new MooPlay.Control.PlayProgress(slider_progress, $('video'));
    
    var progressbar = new ProgressBar({
        container: $('progress_container'),
        startPercentage: 0,
        step: 0,
    });
    new MooPlay.Control.LoadProgress(progressbar, $('video'));
    
    reader = new MooPlay.Subtitle.Player($('video'), $('subtitle'), {
        onDisplay: function(element, container, overlapping) {
            element.addClass('overlapping' + String(overlapping));
            element.setStyles({
                'left': container.offsetWidth
            });
            element.inject(container, 'bottom');
            var effect = new Fx.Morph(element, {
                fps: 30,
                link: 'cancel',
                duration: 150
            });
            effect.start({
                'left': 0
            });

        },
        onDispose: function(element, container, overlapping) {
            element.setStyles({
                'margin-left': 0
            });
            var effect = new Fx.Morph(element, {
                fps: 30,
                link: 'cancel',
                duration: 80,
                onComplete: function() {
                    element.dispose();
                    element.removeClass('overlapping' + String(overlapping));
                }
            });
            effect.start({
                'left': -container.offsetWidth
            });
        }
    });
    
    $('subtitles').addEvent('change', function(e) {
        e.preventDefault();
        if(e.target.value != '') {
            var loader = new MooPlay.Subtitle.Loader( e.target.value, {
                onComplete: function(subs_hash) {
                    reader.loadSubtitles(subs_hash);
                }
            });
        } else {
               reader.unLoad();
        }
        
    });
    
    $('time_shift').addEvent('submit', function(e){
        e.preventDefault();
        reader.setTimeShift($('time_shift_setter').value);
    });
});
</script>

</body>
</html>
