<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>Mooplay demonstration : build your own player on top of an html5 video element</title>

	<!-- MooTools -->
    <script src="/Assets/mootools-1.2.4-core-nc.js" type="text/javascript"></script>
    <script src="/Assets/mootools-1.2.4.4-more.js" type="text/javascript"></script>
    
    <!-- MavSelectBox -->
    <script src="/Assets/class.MavSelectBox.js" type="text/javascript"></script>
    
    <!-- ProgressBar -->
    <script src="/Assets/ProgressBar.js" type="text/javascript"></script>

    <!-- SubRipReader -->
    <script src="/Assets/mooplay.0.5.js" type="text/javascript"></script>
    
	<link rel="stylesheet" href="demo.css" type="text/css" media="screen" title="no title" charset="utf-8">
</head>


<body>

<a href="http://github.com/challet/MooPlay/">
    <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png" alt="Fork me on GitHub" />
</a>

<div id="player">
    <video id="video" src="http://blip.tv/file/get/Framasoft-WhatsNewInFirefox35717.ogv" autobuffer="false" style=""></video>
    <div id="subtitle"></div>

    <div id="controls">

        <div class="layer"></div>
        
        <div class="pannel">
            <div id="line1">

                <a id="info" href="http://mootools.net/forge/p/mooplay" target="_blank"></a>

                <select id="subtitles_select">
                    <option value="" class="none">no</option>
                    <option value="/Assets/Framasoft-WhatsNewInFirefox35717.srt" class="en">en</option>
                    <option value="/Assets/Framasoft-WhatsNewInFirefox35717.srt" class="fr">fr</option>
                    <option value="/Assets/Framasoft-WhatsNewInFirefox35717.sub" class="fr">fr</option>
                    <option value="/Assets/Framasoft-WhatsNewInFirefox35717.srt" class="es">es</option>
                    <option value="/Assets/Framasoft-WhatsNewInFirefox35717.srt" class="it">it</option>
                </select>
                
                <a id="playpause" href="#"></a>

                <a id="mute" href="#"></a>
            
                <div id="slider_volume">
                    <div id="full_volume"></div>
                    <div id="knob_volume"></div>
                </div>
                
                <div id="separator"></div>
                
                <a id="fullscreen" href="#"></a>
                
            </div>
            <div class="clear"></div>
            <div id="line2">
                <div class="time">
                    <span id="current_time_container">0:00:00</span>
                </div>
                
                <div id="progresses_bar">
                    <div id="load"></div>
                    <div id="time_tooltip"></div>
                    <div id="play_slider">
                        <div id="knob_slider"></div>
                    </div>
                </div>

                <div class="time">
                    - <span id="remaining_time_container">0:00:00</span>
                </div>
            </div>
            
        </div>

    </div>
    
    <!--
    <div id="pause">play</div>
    -->

</div>

<div class="clear"></div>

<br />




<form id="time_shift">
    
    <br />
    
    <label for="time_shift_setter">subs time shift :</label>
    <input type="text" id="time_shift_setter" value="8050" /> 
    
    <input type="submit" value="set" />
    
</form>

<hr />
<p> The video used in this demonstration page is from Framasoft and the original file can be found <a href="http://blip.tv/file/2296139">here</a> </p>
<p> The subtitle file is a french translation made by Joan from Framalang and can be found <a href="http://www.framalang.org/wiki/Whats_new_in_firefox_three_five">here</a> </p>
<p>
    Want to see unit tests running ? you may go <a href="/Specs/?specs=master">here</a>
</p>
<script>

var reader = null;

document.addEvent('domready', function() {

    new MooPlay.Control.PlayPause($('playpause'), $('video'));

    new MooPlay.Control.TimeDisplay($('video'), $('current_time_container'), {pattern: '{h}:{m}:{s}', current: true});
    new MooPlay.Control.TimeDisplay($('video'), $('remaining_time_container'), {pattern: '{h}:{m}:{s}', current: false});

    var slider_volume = new Slider($('slider_volume'), $('knob_volume'), {steps: 100});
    var volume_ctrl = new MooPlay.Control.Volume(slider_volume, $('video'));
    $('video').addEvent('volumechange', function(event) {
        var volume = event.target.muted ? 0 : event.target.volume;
        $('full_volume').setStyle('width', String(volume * 100) + '%');
    });
    new MooPlay.Control.Mute($('mute'), $('video'));
    
    var slider_progress = new Slider($('play_slider'), $('knob_slider'), {steps: 400});
    new MooPlay.Control.PlayProgress(slider_progress, $('video'));
    
    var time_tooltip = new MooPlay.Control.TimeDisplay($('video'), $('time_tooltip'), { pattern: '{h}:{m}', auto_update: false});
    
    $('play_slider').addEvents({
        'mousemove':  function(event) {
            // make tooltip to appear
            var position = event.page[slider_progress.axis] - slider_progress.element.getPosition()[slider_progress.axis] - slider_progress.half;
    		position = position.limit(-slider_progress.options.offset, slider_progress.full -slider_progress.options.offset);
            time_tooltip.update(1000 * $('video').duration * slider_progress.toStep(position) / slider_progress.steps);
            $('time_tooltip').setStyle('left', (String(Math.round(position - 9)) + 'px'));
        },
        'mouseenter': function() {
            $('time_tooltip').setStyle('display', 'block');
        },
        'mouseleave': function() {
            $('time_tooltip').setStyle('display', 'none');
        }
    });
    
    var progressbar = new ProgressBar({
        container: $('load'),
        startPercentage: 0,
        step: 0,
    });
    new MooPlay.Control.LoadProgress(progressbar, $('video'));
        
    $('playpause').addEvent('mousemove', function() {
        if(!$('playpause').hasClass('paused') && !$('controls').hasClass('displayed')) {
            $('controls').addClass('displayed');
            $('controls').removeClass.delay(5000,$('controls'),'displayed');
        }
    });
    $('playpause').addEvent('mouseleave', function() {
        if(!$('playpause').hasClass('paused')) {
            $('controls').removeClass('displayed');
        }
    });
    
    var reader = new MooPlay.Subtitle.Player($('video'), $('subtitle'), {
        onDisplay: function(element, container, overlapping) {
            element.addClass('overlapping' + String(overlapping));
            element.setStyles({
                'left': container.offsetWidth
            });
            element.inject(container, 'bottom');
            var effect = new Fx.Morph(element, {
                fps: 30,
                link: 'cancel',
                duration: 150
            });
            effect.start({
                'left': 0
            });

        },
        onDispose: function(element, container, overlapping) {
            element.setStyles({
                'margin-left': 0
            });
            var effect = new Fx.Morph(element, {
                fps: 30,
                link: 'cancel',
                duration: 80,
                onComplete: function() {
                    element.dispose();
                    element.removeClass('overlapping' + String(overlapping));
                }
            });
            effect.start({
                'left': -container.offsetWidth
            });
        }
    });
    
    var mySelect = new MavSelectBox({
        elem: $('subtitles_select'),
        selectboxClass: 'subtitles_select',
        selectmenuClass: 'options',
        optionClass: '',
        fxProperty: 'height',
        fxFrom: 0,
        fxTo: 115,
        showStyles: true
    });
    
    
    
    mySelect.addEvent('select', function() {
        var value = $('subtitles_select').value;
        if(value != '') {
            var loader = new MooPlay.Subtitle.Loader( value, {
                onComplete: function(subs_hash) {
                    reader.loadSubtitles(subs_hash);
                }
            });
        } else {
            reader.unLoad();
        }
        
    });
    
    $('time_shift').addEvent('submit', function(e){
        e.preventDefault();
        reader.setTimeShift($('time_shift_setter').value);
    });
    

    var controls_fx = new Fx.Tween($('controls'), {property: 'opacity', link: 'ignore', duration: 300});
    var timer_hide = null;
    var visible = false;
    function pannel_show() {
        $clear(timer_hide);
        timer_hide = window.setTimeout(pannel_hide, 5000);
        if(!visible) {
            controls_fx.cancel();
            visible = true;
            $('player').setStyle('cursor', 'default');
            controls_fx.start(1);
        }
        
    }
    function pannel_hide() {
        if(visible) {
            controls_fx.cancel();
            visible = false;
            $('player').setStyle('cursor', 'none');
            controls_fx.start(0);
        }
    }
    $('player').addEvents({
        'mousemove': pannel_show,
        'click': pannel_show,
        'mouseleave': pannel_hide
    });
    
    
});
</script>

<script type="text/javascript">

  if(document.location.host == 'mooplay.challet.eu') {
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-16704860-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
  }

</script>

</body>
</html>
